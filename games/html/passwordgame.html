<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Password Game</title>
  <style>
    :root {
      --primary: #4a6fa5;
      --success: #4caf50;
      --warning: #ff9800;
      --danger: #f44336;
      --light: #f8f9fa;
      --dark: #343a40;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
      width: 600px;
      max-width: 95%;
    }

    h1 {
      color: var(--primary);
      text-align: center;
      margin-bottom: 10px;
      font-size: 2.2rem;
    }
    
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 1.1rem;
    }

    .input-container {
      position: relative;
      margin-bottom: 30px;
    }

    .input-container label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--dark);
    }

    input {
      width: 100%;
      padding: 15px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1.1em;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }

    input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
    }

    .strength-meter {
      height: 6px;
      margin: 10px 0;
      border-radius: 3px;
      background: #eee;
      overflow: hidden;
    }

    .strength-meter-fill {
      height: 100%;
      width: 0%;
      transition: width 0.3s ease;
      background: linear-gradient(90deg, #ff9d00, #24c6dc, #4caf50);
    }

    .rules-container {
      max-height: 400px;
      overflow-y: auto;
      padding-right: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
      background: var(--light);
      padding: 20px;
    }

    .rules-title {
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--dark);
      border-bottom: 1px solid #dee2e6;
      padding-bottom: 10px;
    }

    .rules-list {
      list-style-type: none;
      padding: 0;
      margin: 0;
    }

    .rule-item {
      padding: 12px 15px;
      margin-bottom: 8px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      background: white;
      border-left: 4px solid #ddd;
      transition: all 0.3s ease;
    }

    .rule-item.locked {
      opacity: 0.5;
      background: #f5f5f5;
    }

    .rule-item.pass {
      border-left-color: var(--success);
    }

    .rule-item.fail {
      border-left-color: var(--danger);
    }

    .rule-number {
      background: #eee;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      margin-right: 12px;
      font-weight: bold;
      font-size: 0.8rem;
    }

    .rule-item.pass .rule-number {
      background: var(--success);
      color: white;
    }

    .rule-item.fail .rule-number {
      background: var(--danger);
      color: white;
    }

    .rule-text {
      flex-grow: 1;
    }

    .rule-icon {
      margin-left: 10px;
      font-size: 1.2rem;
    }

    .color-preview {
      width: 20px;
      height: 20px;
      display: inline-block;
      border-radius: 4px;
      border: 1px solid #ddd;
      vertical-align: middle;
      margin-left: 8px;
    }

    .captcha-container {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      margin-top: 5px;
      display: inline-flex;
      align-items: center;
    }

    .captcha-math {
      font-weight: bold;
      margin-right: 10px;
    }

    .captcha-answer {
      font-weight: bold;
      color: var(--primary);
    }

    .refresh-captcha {
      background: none;
      border: none;
      color: var(--primary);
      cursor: pointer;
      font-size: 1rem;
      margin-left: 10px;
      padding: 0;
    }

    .celebration {
      text-align: center;
      padding: 20px;
      background: linear-gradient(45deg, #6ab7ff, #4caf50);
      color: white;
      border-radius: 8px;
      margin-top: 20px;
      animation: pulse 2s infinite;
      display: none;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .tips-container {
      margin-top: 20px;
      padding: 15px;
      background: #fff8e1;
      border-left: 4px solid var(--warning);
      border-radius: 4px;
      font-size: 0.9rem;
    }

    .progress-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .progress-text {
      font-weight: 600;
      color: var(--primary);
    }

    /* Font selector for Wingdings rule */
    .font-selector {
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .font-option {
      padding: 5px 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .font-option:hover {
      background-color: #f0f0f0;
    }

    .font-option.selected {
      background-color: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .font-wingdings {
      font-family: 'Wingdings', sans-serif;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }
      
      h1 {
        font-size: 1.8rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>The Password Game</h1>
    <p class="subtitle">Can you create the ultimate password by meeting all the challenges?</p>
    
    <div class="progress-container">
      <div class="progress-text">
        <span id="completedRules">0</span>/<span id="totalRules">0</span> Rules Completed
      </div>
    </div>
    
    <div class="strength-meter">
      <div class="strength-meter-fill" id="strengthMeter"></div>
    </div>
    
    <div class="input-container">
      <label for="password">Your Password:</label>
      <input type="text" id="password" placeholder="Start typing to unlock challenges..." autocomplete="off" />
    </div>
    
    <div class="rules-container">
      <div class="rules-title">Password Challenges</div>
      <ul class="rules-list" id="rules"></ul>
    </div>
    
    <div class="celebration" id="celebration">
      <h2>🎉 Congratulations! 🎉</h2>
      <p>You've mastered all the password challenges!</p>
    </div>
    
    <div class="tips-container">
      <strong>Hint:</strong> Start simple and address one rule at a time. New challenges unlock as you solve the current ones.
    </div>
  </div>

  <script>
  const passwordInput = document.getElementById('password');
  const rulesList = document.getElementById('rules');
  const strengthMeter = document.getElementById('strengthMeter');
  const completedRulesElem = document.getElementById('completedRules');
  const totalRulesElem = document.getElementById('totalRules');
  const celebrationElem = document.getElementById('celebration');

  const countryList = ["Denmark", "Djibouti", "Dominica", "Dominican Republic"];
  const romanNumerals = ["I", "II", "III", "IV", "V", "VI", "VII", "VIII", "IX", "X"];
  const onomatopoeias = ["boom", "bang", "buzz", "zap", "crash", "pop", "pow", "wham", "smack", "bam", "beep", "zoom"];
  
  // Common emoji for the emoji rule
  const commonEmojis = ["😀", "😂", "❤️", "👍", "🔥", "🎉", "✨", "🌟", "👏", "🙏", "😎", "🤔"];

  // Wingdings characters
  const wingdingsChars = ["", "", "", "", "", "", "", "", "", ""];

  // Captcha variables
  let captchaNum1 = Math.floor(Math.random() * 20) + 1;
  let captchaNum2 = Math.floor(Math.random() * 10) + 1;
  let captchaOperator = Math.random() > 0.5 ? '+' : '-';
  let captchaAnswer = captchaOperator === '+' ? captchaNum1 + captchaNum2 : captchaNum1 - captchaNum2;

  function regenerateCaptcha() {
    captchaNum1 = Math.floor(Math.random() * 20) + 1;
    captchaNum2 = Math.floor(Math.random() * 10) + 1;
    captchaOperator = Math.random() > 0.5 ? '+' : '-';
    captchaAnswer = captchaOperator === '+' ? captchaNum1 + captchaNum2 : captchaNum1 - captchaNum2;
    renderRules(passwordInput.value);
  }

  let batteryLevel = null;
  navigator.getBattery?.().then(battery => {
    batteryLevel = Math.floor(battery.level * 100);
    renderRules(passwordInput.value); // Ensure rules update once battery is fetched
  }).catch(() => {
    // Fallback if battery API isn't available
    batteryLevel = Math.floor(Math.random() * 100);
    renderRules(passwordInput.value);
  });

  const getDigitSum = str => {
    return [...str].filter(c => /\d/.test(c)).reduce((sum, c) => sum + parseInt(c), 0);
  };

  const isPalindrome = str => {
    const alphanumeric = str.replace(/[^a-z0-9]/gi, '').toLowerCase();
    return alphanumeric === alphanumeric.split('').reverse().join('');
  };

  // Hex color code validation
  const isValidHexCode = str => {
    const hexCodeRegex = /#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})/;
    return hexCodeRegex.test(str);
  };

  // Extract hex code from string
  const extractHexCode = str => {
    const hexCodeRegex = /#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})/;
    const match = str.match(hexCodeRegex);
    return match ? match[0] : null;
  };

  // Emoji validation
  const containsEmoji = str => {
    const emojiRegex = /[\p{Emoji}]/u;
    return emojiRegex.test(str);
  };

  // Vowel bolding check
  const checkBoldedVowels = pwd => {
    // This is a simulated check since we can't actually verify HTML formatting in a password field
    // In a real implementation, we would need to use a rich text field or some other mechanism
    return pwd.includes("<b>a</b>") || 
           pwd.includes("<b>e</b>") || 
           pwd.includes("<b>i</b>") || 
           pwd.includes("<b>o</b>") || 
           pwd.includes("<b>u</b>") ||
           pwd.includes("<strong>a</strong>") || 
           pwd.includes("<strong>e</strong>") || 
           pwd.includes("<strong>i</strong>") || 
           pwd.includes("<strong>o</strong>") || 
           pwd.includes("<strong>u</strong>");
  };

  // Wingdings check
  const containsWingdings = pwd => {
    // Look for a specific marker that indicates Wingdings inclusion
    return pwd.includes("[[WINGDINGS]]") || pwd.includes("[[wingdings]]");
  };

  const rules = [
    { 
      text: "Must be at least 5 characters long", 
      test: pwd => pwd.length >= 5,
      hint: "Add more characters until you have at least 5."
    },
    { 
      text: "Must contain a number", 
      test: pwd => /\d/.test(pwd),
      hint: "Add any digit (0-9) to your password."
    },
    { 
      text: "Must contain an uppercase letter", 
      test: pwd => /[A-Z]/.test(pwd),
      hint: "Add a capital letter (A-Z)."
    },
    { 
      text: "Must contain a special character", 
      test: pwd => /[!@#$%^&*]/.test(pwd),
      hint: "Try adding !, @, #, $, %, ^, &, or *."
    },
    { 
      text: "Must include a country name starting with 'D'", 
      test: pwd => countryList.some(country => pwd.toLowerCase().includes(country.toLowerCase())),
      hint: "Try Denmark, Djibouti, Dominica, or Dominican Republic."
    },
    { 
      text: "Must include a Roman numeral (I–X)", 
      test: pwd => romanNumerals.some(numeral => pwd.includes(numeral)),
      hint: "Add a Roman numeral like I, V, X, or IV."
    },
    { 
      text: "Digits in the password must add up to 33", 
      test: pwd => getDigitSum(pwd) === 33,
      hint: "Add digits that sum to 33"
    },
    { 
      text: "Must include your battery percentage", 
      test: pwd => batteryLevel !== null && pwd.includes(batteryLevel + "%"),
      hint: batteryLevel !== null ? `Include "${batteryLevel}%" in your password.` : "Waiting for battery level..."
    },
    { 
      text: "Must include the number of characters in the password", 
      test: pwd => {
        // This needs special handling since the length can change
        const currentLength = pwd.length;
        return pwd.includes(currentLength.toString());
      },
      hint: "Include the total character count in your password"
    },
    { 
      text: "Must include a math operator (+, -, *, /, =)", 
      test: pwd => /[+\-*/=]/.test(pwd),
      hint: "Add +, -, *, /, or = to your password."
    },
    { 
      text: "Must include an onomatopoeia (sound word)", 
      test: pwd => onomatopoeias.some(sound => pwd.toLowerCase().includes(sound.toLowerCase())),
      hint: "Try adding words like boom, bang, buzz, zap, crash, pop, pow..."
    },
    { 
      text: "Must include a face using punctuation", 
      test: pwd => /(:\)|:\(|:D|:-D|:-\)|;-?\)|\^_\^|T_T|>_<|o_O)/.test(pwd),
      hint: "Add a face like :) :-D ^_^ ;) >_< o_O"
    },
    { 
      text: "Must include a valid hex color code (e.g., #FF5500)", 
      test: pwd => isValidHexCode(pwd),
      hint: "Add a color code like #FFF or #FF5500"
    },
    { 
      text: "Must include the answer to this captcha", 
      test: pwd => pwd.includes(captchaAnswer.toString()),
      hint: "Solve the math problem and include the answer"
    },
    { 
      text: "Must contain at least one emoji 😀", 
      test: pwd => containsEmoji(pwd),
      hint: "Include an emoji like 😀, ❤️, or 👍 in your password."
    },
    { 
      text: "Vowels must be bolded (use <b>a</b> or <strong>e</strong>)", 
      test: pwd => checkBoldedVowels(pwd),
      hint: "Use HTML tags to bold vowels: <b>a</b>, <b>e</b>, <b>i</b>, <b>o</b>, <b>u</b>"
    },
    { 
      text: "Must contain Wingdings (use [[WINGDINGS]] marker)", 
      test: pwd => containsWingdings(pwd),
      hint: "Include the marker [[WINGDINGS]] in your password to indicate Wingdings font"
    }
  ];

  const unlockedRules = new Set([0]);
  
  totalRulesElem.textContent = rules.length;

  function updateProgressMeter(passedRules) {
    const progress = (passedRules / rules.length) * 100;
    strengthMeter.style.width = `${progress}%`;
    completedRulesElem.textContent = passedRules;
    
    if (passedRules === rules.length) {
      celebrationElem.style.display = 'block';
    } else {
      celebrationElem.style.display = 'none';
    }
  }

  function createRuleElement(index, isPassed, isLocked = false, currentPassword = '') {
    const rule = rules[index];
    
    const li = document.createElement('li');
    li.className = isLocked ? 'rule-item locked' : (isPassed ? 'rule-item pass' : 'rule-item fail');
    
    const numberSpan = document.createElement('span');
    numberSpan.className = 'rule-number';
    numberSpan.textContent = index + 1;
    
    const textSpan = document.createElement('span');
    textSpan.className = 'rule-text';
    textSpan.textContent = rule.text;
    
    const iconSpan = document.createElement('span');
    iconSpan.className = 'rule-icon';
    
    if (!isLocked) {
      // Only show icons for unlocked rules
      if (isPassed) {
        iconSpan.textContent = '✓';
        iconSpan.style.color = 'var(--success)';
        
        // For hex code rule, show color preview
        if (index === 12 && isPassed) {
          const hexCode = extractHexCode(currentPassword);
          if (hexCode) {
            const colorPreview = document.createElement('span');
            colorPreview.className = 'color-preview';
            colorPreview.style.backgroundColor = hexCode;
            iconSpan.appendChild(colorPreview);
          }
        }
        
        // For Wingdings rule, show font selector if passed
        if (index === 16 && isPassed) {
          const fontSelector = createFontSelector();
          textSpan.appendChild(document.createElement('br'));
          textSpan.appendChild(fontSelector);
        }
      } else {
        iconSpan.textContent = '✗';
        iconSpan.style.color = 'var(--danger)';
        
        // Add hint for failing rules
        const hintDiv = document.createElement('div');
        hintDiv.style.fontSize = '0.85rem';
        hintDiv.style.marginTop = '5px';
        hintDiv.style.color = '#666';
        
        // For dynamic hints
        if (index === 6) {
          hintDiv.textContent = "Current sum: " + getDigitSum(currentPassword) + " (need 33)";
        } else if (index === 8) {
          hintDiv.textContent = "Current length: " + currentPassword.length + " (include this number)";
        } else if (index === 13) {
          // Create captcha challenge display
          const captchaContainer = document.createElement('div');
          captchaContainer.className = 'captcha-container';
          
          const captchaMath = document.createElement('span');
          captchaMath.className = 'captcha-math';
          captchaMath.textContent = `${captchaNum1} ${captchaOperator} ${captchaNum2} = `;
          
          const captchaAnswerSpan = document.createElement('span');
          captchaAnswerSpan.className = 'captcha-answer';
          captchaAnswerSpan.textContent = '?';
          
          const refreshButton = document.createElement('button');
          refreshButton.className = 'refresh-captcha';
          refreshButton.innerHTML = '&#x21bb;'; // Refresh icon
          refreshButton.title = 'Get a new captcha';
          refreshButton.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            regenerateCaptcha();
          });
          
          captchaContainer.appendChild(captchaMath);
          captchaContainer.appendChild(captchaAnswerSpan);
          captchaContainer.appendChild(refreshButton);
          
          hintDiv.textContent = "Solve this math problem and include the answer:";
          hintDiv.appendChild(document.createElement('br'));
          hintDiv.appendChild(captchaContainer);
        } else if (index === 14) {
          // Emoji picker hint
          hintDiv.innerHTML = "Choose an emoji: " + commonEmojis.join(" ");
          hintDiv.style.fontSize = '1.2rem';
          hintDiv.style.letterSpacing = '0.2rem';
        } else if (index === 16) {
          // For Wingdings rule, show the font previewer
          hintDiv.textContent = rule.hint;
          const wingdingsPreview = document.createElement('div');
          wingdingsPreview.className = 'font-wingdings';
          wingdingsPreview.textContent = "Sample Wingdings: ABCDEFGabcdefg12345";
          wingdingsPreview.style.marginTop = '8px';
          wingdingsPreview.style.padding = '5px';
          wingdingsPreview.style.background = '#f5f5f5';
          wingdingsPreview.style.borderRadius = '4px';
          hintDiv.appendChild(wingdingsPreview);
        } else {
          hintDiv.textContent = rule.hint;
        }
        
        textSpan.appendChild(hintDiv);
      }
    }
    
    li.appendChild(numberSpan);
    li.appendChild(textSpan);
    if (!isLocked) li.appendChild(iconSpan);
    
    return li;
  }

  function createFontSelector() {
    const fontSelectorDiv = document.createElement('div');
    fontSelectorDiv.className = 'font-selector';
    fontSelectorDiv.innerHTML = '<span>Select Wingdings character: </span>';
    
    // Add Wingdings character options
    for (let i = 0; i < 5; i++) {
      const option = document.createElement('span');
      option.className = 'font-option font-wingdings';
      option.textContent = String.fromCharCode(97 + i); // Using lowercase letters a-e for Wingdings preview
      option.addEventListener('click', () => {
        // In a real implementation, this would add the selected Wingdings character
        // to the password, but for this simulation we'll just mark it as selected
        const allOptions = fontSelectorDiv.querySelectorAll('.font-option');
        allOptions.forEach(opt => opt.classList.remove('selected'));
        option.classList.add('selected');
      });
      fontSelectorDiv.appendChild(option);
    }
    
    return fontSelectorDiv;
  }

  function renderRules(pwd) {
    let allPreviousPassed = true;
    let passedCount = 0;
    rulesList.innerHTML = '';

    for (let i = 0; i < rules.length; i++) {
      if (unlockedRules.has(i)) {
        const passed = rules[i].test(pwd);
        if (passed) passedCount++;
        rulesList.appendChild(createRuleElement(i, passed, false, pwd));
        if (!passed) allPreviousPassed = false;
      } else if (allPreviousPassed && i === Math.max(...unlockedRules) + 1) {
        unlockedRules.add(i);
        renderRules(pwd);
        return;
      } else {
        // Show locked rules grayed out
        rulesList.appendChild(createRuleElement(i, false, true, pwd));
      }
    }

    updateProgressMeter(passedCount);
  }

  passwordInput.addEventListener('input', e => {
    renderRules(e.target.value);
  });

  // Initial render
  renderRules('');
  
  // Focus the input field automatically
  passwordInput.focus();
</script>
</body>
</html>
